SHELL = @SHELL@
srcdir = @srcdir@
VPATH = @srcdir@
PLATFORM_DIR = $(srcdir)/..
CC = @CC@
.SUFFIXES:
.SUFFIXES: .c .o

PKG_CONFIG = @PKG_CONFIG@
LIBS = @LIBS@ -lXtst

CFLAGS = -I. -I${srcdir} @CFLAGS@ \
	`${PKG_CONFIG} --cflags gtk+-2.0 libxml-2.0 dbus-1 dbus-glib-1`
LDFLAGS = @LDFLAGS@ `${PKG_CONFIG} --libs gtk+-2.0 libxml-2.0 dbus-1 dbus-glib-1` ${LIBS}

############ Things to change for different programs

PROG = ROX-Session

SRCS = main.c choices.c dbus.c dpms.c gui_support.c i18n.c log.c options.c \
	rox_gettext.c session.c settings.c wm.c xsettings-common.c \
	xsettings-manager.c xkb.c

OBJECTS = main.o choices.o dbus.o dpms.o gui_support.o i18n.o log.o options.o \
	rox_gettext.o session.o settings.o wm.o xsettings-common.o \
	xsettings-manager.o xkb.o

############ Things to keep the same

${PROG}: ${OBJECTS}
	${CC} -o "${PROG}" ${OBJECTS} ${LDFLAGS}
	mv "${PROG}" "${PLATFORM_DIR}"
	-(cd "${PLATFORM_DIR}" && \
	 objcopy --only-keep-debug ROX-Session ROX-Session.dbg && \
	 strip ROX-Session && \
	 objcopy --add-gnu-debuglink=ROX-Session.dbg ROX-Session)

clean:
	rm -f *.o Makefile.bak

depend:
	makedepend -- ${CFLAGS} -- ${SRCS}

Makefile: Makefile.in config.status
	./config.status

config.h: config.h.in
	./config.status

config.status: configure
	APP_DIR="$(srcdir)/.." $(srcdir)/configure

configure: configure.in
	cd $(srcdir) && autoconf
